<!doctype html>
<html lang="cs">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>Druh√© odmocniny ‚Äì kola po 15 p≈ô√≠kladech</title>
<meta name="theme-color" content="#0b1323" />
<style>
  :root{
    --bg:#0b1323; --panel:#0f1729; --text:#e6eef8; --muted:#9fb0c7; --accent:#60a5fa;
    --ok:#22c55e; --wrong:#ef4444; --card:#101826;
  }
  *{box-sizing:border-box}
  html,body{
    height:100%;margin:0;
    background:linear-gradient(180deg,var(--bg),#0d1528);
    color:var(--text);
    font:16px/1.5 system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif
  }
  .app{max-width:min(800px,96vw);margin:24px auto;padding:16px}
  header{display:flex;align-items:center;justify-content:space-between;gap:12px;margin-bottom:16px;flex-wrap:wrap}
  .tag{
    padding:4px 10px;
    border-radius:999px;
    border:1px solid #233152;
    color:var(--muted);
    font-size:13px;
  }
  .btn{
    appearance:none;border:1px solid #25324f;background:#15203a;
    color:var(--text);padding:8px 14px;border-radius:12px;cursor:pointer;
    font-size:14px;
  }
  .btn.primary{border-color:#245bb5;background:#1b3b70}
  .btn:disabled{opacity:.5;cursor:default}
  .panel{
    background:var(--panel);
    border-radius:18px;
    border:1px solid #1b2946;
    padding:16px;
  }
  .qtext{
    font-size:24px;
    line-height:1.3;
    margin-bottom:12px;
    min-height:2em;
  }
  .status{
    font-size:14px;
    color:var(--muted);
    min-height:1.5em;
  }
  .status.ok{color:var(--ok)}
  .status.bad{color:var(--wrong)}
  .answer-area{
    margin:10px 0 4px;
  }

  .whole-input{
    padding:8px 10px;
    border-radius:10px;
    border:1px solid #243356;
    background:#0f1729;
    color:var(--text);
    font-size:18px;
    width:160px;
  }
  .whole-input:focus{outline:none;border-color:var(--accent)}

  .frac-wrapper{
    display:none;
    align-items:center;
    justify-content:flex-start;
    gap:6px;
  }
  .frac-box{
    display:inline-flex;
    flex-direction:column;
    align-items:stretch;
    justify-content:center;
  }
  .frac-input{
    width:120px;
    padding:4px 8px;
    border-radius:6px;
    border:1px solid #243356;
    background:#0f1729;
    color:var(--text);
    font-size:16px;
    text-align:center;
  }
  .frac-input:focus{outline:none;border-color:var(--accent)}
  .frac-bar{
    height:1px;
    background:#e5e7eb;
    margin:3px 0;
  }

  .kbd{
    margin-top:10px;
    display:grid;
    grid-template-columns:repeat(4, minmax(0,1fr));
    gap:6px;
  }
  .kbd button{
    padding:10px 0;
    font-size:18px;
    border-radius:10px;
    border:1px solid #243356;
    background:#101826;
    color:var(--text);
    cursor:pointer;
  }
  .kbd button:hover{background:#18233e}
  .kbd button.k-wide{
    grid-column:span 2;
  }

  .bottom-bar{
    display:flex;
    justify-content:space-between;
    align-items:center;
    margin-top:12px;
    gap:10px;
    flex-wrap:wrap;
  }

  .icons-wrap{
    position:fixed;
    top:8px;
    right:10px;
    display:flex;
    flex-direction:column;
    gap:4px;
    z-index:10;
    font-size:18px;
  }
  .icons-line{
    display:flex;
    gap:4px;
    align-items:center;
  }
</style>

<!-- MathJax -->
<script id="MathJax-script" async
  src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
</script>
</head>
<body>
<div class="icons-wrap">
  <div class="icons-line">
    üëµ <span id="grannyCount">0</span>
  </div>
  <div class="icons-line">
    üòà <span id="devilCount">0</span>
  </div>
</div>

<div class="app">
  <header>
    <div class="tag">Kolo: <span id="roundNo">1</span></div>
    <div class="tag">P≈ô√≠klad v kole: <span id="qIndex">1</span> / 15</div>
    <div class="tag">Spr√°vn√Ωch celkem: <span id="qCorrect">0</span></div>
    <div class="tag">≈†patn√Ωch celkem: <span id="qWrong">0</span></div>
    <div style="flex:1"></div>
    <button class="btn" id="btnResetAll">Reset v≈°e</button>
  </header>

  <section class="panel">
    <div class="qtext" id="qText"></div>

    <div class="answer-area">
      <input id="answerWhole" class="whole-input" autocomplete="off" inputmode="decimal" />
      <div id="fracWrapper" class="frac-wrapper">
        <span>=</span>
        <div class="frac-box">
          <input id="answerNum" class="frac-input" autocomplete="off" inputmode="numeric" />
          <div class="frac-bar"></div>
          <input id="answerDen" class="frac-input" autocomplete="off" inputmode="numeric" />
        </div>
      </div>
    </div>

    <div class="kbd" id="kbd">
      <button data-key="7">7</button>
      <button data-key="8">8</button>
      <button data-key="9">9</button>
      <button data-key="back">‚Üê</button>

      <button data-key="4">4</button>
      <button data-key="5">5</button>
      <button data-key="6">6</button>
      <button data-key="clear">C</button>

      <button data-key="1">1</button>
      <button data-key="2">2</button>
      <button data-key="3">3</button>
      <button data-key="neg">‚àí</button>

      <button data-key="0">0</button>
      <button data-key=",">,</button>
      <button class="k-wide" data-key="frac">zlomkov√° ƒç√°ra</button>

      <!-- nov√© tlaƒç√≠tko pro "neexistuje" -->
      <button class="k-wide" data-key="noexist">neexistuje</button>
    </div>

    <div class="bottom-bar">
      <div>
        <button class="btn primary" id="btnCheck">Ovƒõ≈ôit v√Ωsledek</button>
        <button class="btn" id="btnNext" disabled>Dal≈°√≠ p≈ô√≠klad</button>
        <button class="btn" id="btnNextRound" disabled>Dal≈°√≠ kolo</button>
      </div>
      <div id="status" class="status"></div>
    </div>
  </section>
</div>

<script>
/* ---------- pomocn√© funkce pro ƒç√≠sla / zlomky ---------- */
function randInt(min, max){
  return Math.floor(Math.random()*(max-min+1))+min;
}
function choice(arr){
  return arr[Math.floor(Math.random()*arr.length)];
}
function gcd(a,b){
  a=Math.abs(a); b=Math.abs(b);
  while(b){ let t=a%b; a=b; b=t; }
  return a||1;
}
function makeFrac(n,d){
  if(d === 0) return {n:1,d:0};
  if(d < 0){ n=-n; d=-d; }
  const g = gcd(n,d);
  n = n/g; d = d/g;
  return {n,d};
}
function mulFrac(a,b){ return makeFrac(a.n*b.n, a.d*b.d); }
function fracValue(fr){ return fr.n/fr.d; }

/* form√°t desetinn√©ho ƒç√≠sla s ƒç√°rkou (max 4 desetinn√° m√≠sta) */
function fmtDec(x){
  let s = x.toFixed(4);
  s = s.replace('.', ',');
  if(s.includes(',')){
    s = s.replace(/0+$/,'').replace(/,$/,'');

  }
  return s;
}

/* jednoduch√Ω TeX pro zlomek (v√Ωsledky) */
function texFracSimple(fr){
  const n = fr.n, d = fr.d;
  if(d === 1) return String(n);
  const absn = Math.abs(n);
  const sign = n < 0 ? '-' : '';
  return sign + '\\frac{' + absn + '}{' + d + '}';
}

/* ---------- gener√°tor 15 typ≈Ø p≈ô√≠klad≈Ø na druhou odmocninu ---------- */

function generateQuestions(){
  const qs = [];

  // 1) ‚àö(n^2), n kladn√© do 20
  const n1 = randInt(1,20);
  const ans1 = makeFrac(n1,1);
  const rad1 = n1*n1;
  qs.push({
    latex: '\\sqrt{' + rad1 + '} =',
    frac: ans1,
    value: fracValue(ans1)
  });

  // 2) ‚àö((-n)^2)
  const n2 = randInt(1,20);
  const ans2 = makeFrac(n2,1);
  qs.push({
    latex: '\\sqrt{\\left(-' + n2 + '\\right)^2} =',
    frac: ans2,
    value: fracValue(ans2)
  });

  // 3) -‚àö(n^2)
  const n3 = randInt(1,20);
  const ans3 = makeFrac(-n3,1);
  const rad3 = n3*n3;
  qs.push({
    latex: '-\\sqrt{' + rad3 + '} =',
    frac: ans3,
    value: fracValue(ans3)
  });

  // 4) ‚àö(a^2), a z (0,10‚Äì0,19)
  const k4 = randInt(10,19);             // 10..19
  const base4Frac = makeFrac(k4,100);    // 0,10 .. 0,19
  const base4Str = '0,' + String(k4);
  const rad4Frac = mulFrac(base4Frac, base4Frac);
  const rad4Str = fmtDec(fracValue(rad4Frac));
  qs.push({
    latex: '\\sqrt{' + rad4Str + '} =',
    frac: base4Frac,
    value: fracValue(base4Frac)
  });

  // helper pro velk√° ƒç√≠sla (typ 5,8,9,11)
  function genTypeBig(){
    const len = randInt(2,5);
    const useTwo = Math.random()<0.5;
    if(useTwo && len>=2){
      const firstTwo = randInt(11,19);
      const pow10 = Math.pow(10, len-2);
      return firstTwo * pow10;
    }else{
      const firstDigit = randInt(1,9);
      const pow10 = Math.pow(10, len-1);
      return firstDigit * pow10;
    }
  }

  // 5) ‚àö(N^2), N velk√© ƒç√≠slo
  const n5 = genTypeBig();
  const base5Frac = makeFrac(n5,1);
  const ans5 = base5Frac;
  const rad5 = n5*n5;
  qs.push({
    latex: '\\sqrt{' + rad5 + '} =',
    frac: ans5,
    value: fracValue(ans5)
  });

  // 6) ‚àö((‚àía)^2) ‚Äì jin√° desetinn√° <1
  const k6 = randInt(10,19);
  const base6Frac = makeFrac(k6,100);
  const base6Str = '0,' + String(k6);
  qs.push({
    latex: '\\sqrt{\\left(-' + base6Str + '\\right)^2} =',
    frac: base6Frac,
    value: fracValue(base6Frac)
  });

  // 7) -‚àö(b^2) ‚Äì jin√° desetinn√° <1
  const k7 = randInt(10,19);
  const base7Frac = makeFrac(k7,100);
  const base7Str = '0,' + String(k7);
  const rad7Frac = mulFrac(base7Frac, base7Frac);
  const rad7Str = fmtDec(fracValue(rad7Frac));
  const ans7 = makeFrac(-base7Frac.n, base7Frac.d);
  qs.push({
    latex: '-\\sqrt{' + rad7Str + '} =',
    frac: ans7,
    value: fracValue(ans7)
  });

  // 8) ‚àö((‚àíN)^2) ‚Äì jin√© velk√© N
  const n8 = genTypeBig();
  const base8Frac = makeFrac(n8,1);
  const ans8 = base8Frac;
  qs.push({
    latex: '\\sqrt{\\left(-' + n8 + '\\right)^2} =',
    frac: ans8,
    value: fracValue(ans8)
  });

  // 9) -‚àö(N^2) ‚Äì jin√© velk√© N
  const n9 = genTypeBig();
  const base9Frac = makeFrac(n9,1);
  const rad9 = n9*n9;
  const ans9 = makeFrac(-base9Frac.n, base9Frac.d);
  qs.push({
    latex: '-\\sqrt{' + rad9 + '} =',
    frac: ans9,
    value: fracValue(ans9)
  });

  // 10) ‚àö(z√°porn√©ho cel√©ho ƒç√≠sla), nap≈ô. ‚àö(-2)
  const n10 = randInt(1,20);
  qs.push({
    latex: '\\sqrt{-' + n10 + '} =',
    noexist: true
  });

  // 11) ‚àö(z√°porn√©ho velk√©ho ƒç√≠sla)
  const n11 = genTypeBig();
  qs.push({
    latex: '\\sqrt{-' + n11 + '} =',
    noexist: true
  });

  // 12) ‚àö(z√°porn√©ho desetinn√©ho ƒç√≠sla <1)
  const k12 = randInt(10,99); // 0,10‚Äì0,99
  const base12Str = '0,' + String(k12).padStart(2,'0');
  qs.push({
    latex: '\\sqrt{-' + base12Str + '} =',
    noexist: true
  });

  // 13) ‚àö((zlomek)^2)
  const denChoices = [2,4,5,8,10,20];
  const d13 = choice(denChoices);
  const n13 = randInt(1,20);
  const base13 = makeFrac(n13,d13);
  const ans13 = base13;
  qs.push({
    latex: '\\sqrt{\\left(' + texFracSimple(base13) + '\\right)^2} =',
    frac: ans13,
    value: fracValue(ans13)
  });

  // 14) ‚àö((‚àízlomek)^2)
  const d14 = choice(denChoices);
  const n14 = randInt(1,20);
  const base14 = makeFrac(n14,d14);
  const ans14 = base14;
  const neg14 = makeFrac(-base14.n, base14.d);
  qs.push({
    latex: '\\sqrt{\\left(' + texFracSimple(neg14) + '\\right)^2} =',
    frac: ans14,
    value: fracValue(ans14)
  });

  // 15) -‚àö((zlomek)^2)
  const d15 = choice(denChoices);
  const n15 = randInt(1,20);
  const base15 = makeFrac(n15,d15);
  const ans15 = makeFrac(-base15.n, base15.d);
  qs.push({
    latex: '-\\sqrt{\\left(' + texFracSimple(base15) + '\\right)^2} =',
    frac: ans15,
    value: fracValue(ans15)
  });

  // üîÄ prom√≠ch√°n√≠ po≈ôad√≠ (Fisher‚ÄìYates)
  for(let i = qs.length - 1; i > 0; i--){
    const j = Math.floor(Math.random() * (i + 1));
    [qs[i], qs[j]] = [qs[j], qs[i]];
  }

  return qs;
}

/* ---------- stav ---------- */
let roundNo = 1;
let questions = generateQuestions();
let index = 0;
let correctCount = 0;
let wrongCount = 0;
let grannyCount = 0;
let devilCount = 0;
let streakConsec = 0;
let roundFinished = false;

const elRoundNo = document.getElementById('roundNo');
const elQText  = document.getElementById('qText');
const elQIndex = document.getElementById('qIndex');
const elQCorrect = document.getElementById('qCorrect');
const elQWrong   = document.getElementById('qWrong');
const elStatus   = document.getElementById('status');

const elWhole = document.getElementById('answerWhole');
const elFracWrap = document.getElementById('fracWrapper');
const elNum = document.getElementById('answerNum');
const elDen = document.getElementById('answerDen');

const elBtnCheck = document.getElementById('btnCheck');
const elBtnNext = document.getElementById('btnNext');
const elBtnNextRound = document.getElementById('btnNextRound');
const elBtnResetAll = document.getElementById('btnResetAll');
const elKbd = document.getElementById('kbd');

const elGrannyCount = document.getElementById('grannyCount');
const elDevilCount  = document.getElementById('devilCount');

let fractionMode = false;
let activeInput = elWhole;

/* ---------- UI / MathJax ---------- */
function typeset(el){
  if(window.MathJax && MathJax.typesetPromise){
    MathJax.typesetPromise([el]).catch(()=>{});
  }
}

function setStatus(msg, kind, isTeX){
  elStatus.className = "status";
  if(kind === "ok") elStatus.classList.add("ok");
  if(kind === "bad") elStatus.classList.add("bad");
  elStatus.innerHTML = isTeX ? msg : msg.replace(/</g,"&lt;");
  typeset(elStatus);
}

function clearAnswer(){
  elWhole.value = "";
  elNum.value = "";
  elDen.value = "";
  fractionMode = false;
  elWhole.style.display = "inline-block";
  elFracWrap.style.display = "none";
  activeInput = elWhole;
  elBtnNext.disabled = true;
  elBtnCheck.disabled = false;
  elWhole.focus();
}

function showQuestion(){
  const q = questions[index];
  elQIndex.textContent = String(index+1);
  elQText.innerHTML = '\\(' + q.latex + '\\)';
  typeset(elQText);
  clearAnswer();
  setStatus("", null, false);
  roundFinished = false;
}

/* ---------- ƒçten√≠ odpovƒõdi ---------- */
function parseNumber(str){
  const s = str.replace(',', '.').trim();
  if(!s) return null;
  const n = Number(s);
  return Number.isFinite(n) ? n : null;
}

function getUserValue(){
  // speci√°ln√≠ odpovƒõƒè "neexistuje"
  if(!fractionMode && elWhole.value.trim().toUpperCase() === "NEEXISTUJE"){
    return { ok:true, noexist:true };
  }

  if(fractionMode){
    const a = parseNumber(elNum.value);
    const b = parseNumber(elDen.value);
    if(a === null || b === null || b === 0) return {ok:false, msg:"Dopl≈à ƒçitatel i jmenovatel (jmenovatel nesm√≠ b√Ωt 0)."};
    return {ok:true, value:a / b};
  }else{
    const a = parseNumber(elWhole.value);
    if(a === null) return {ok:false, msg:"Zadej v√Ωsledek (desetinn√° ƒç√°rka je , )."};
    return {ok:true, value:a};
  }
}

/* ---------- kontrola ---------- */
function addGrannyIfNeeded(){
  if(streakConsec > 0 && streakConsec % 6 === 0){
    grannyCount++;
    elGrannyCount.textContent = String(grannyCount);
  }
}

function checkAnswer(){
  const res = getUserValue();
  if(!res.ok){
    setStatus(res.msg, "bad", false);
    return;
  }

  const q = questions[index];

  // nejd≈ô√≠v √∫lohy, kde v√Ωsledek v R neexistuje
  if(q.noexist === true){
    if(res.noexist){
      // ≈æ√°k spr√°vnƒõ zvolil "neexistuje"
      correctCount++;
      elQCorrect.textContent = String(correctCount);
      streakConsec++;
      addGrannyIfNeeded();
      setStatus("Spr√°vnƒõ üëå ‚Äì v oboru re√°ln√Ωch ƒç√≠sel neexistuje.", "ok", false);
    }else{
      // ≈æ√°k zadal ƒç√≠slo tam, kde odmocnina neexistuje
      wrongCount++;
      devilCount++;
      elQWrong.textContent = String(wrongCount);
      elDevilCount.textContent = String(devilCount);
      streakConsec = 0;
      setStatus("≈†patnƒõ. V oboru re√°ln√Ωch ƒç√≠sel neexistuje ≈æ√°dn√© ƒç√≠slo, jeho≈æ druh√° mocnina by dala toto ƒç√≠slo pod odmocninou.", "bad", false);
    }

    elBtnCheck.disabled = true;
    if(index >= questions.length-1){
      elBtnNext.disabled = true;
      elBtnNextRound.disabled = false;
      roundFinished = true;
    }else{
      elBtnNext.disabled = false;
    }
    return;
  }

  // standardn√≠ √∫lohy s ƒç√≠seln√Ωm v√Ωsledkem
  const user = res.value;
  const correct = q.value;
  const diff = Math.abs(user - correct);

  if(diff < 1e-6){
    correctCount++;
    elQCorrect.textContent = String(correctCount);
    streakConsec++;
    addGrannyIfNeeded();
    setStatus("Spr√°vnƒõ üëå", "ok", false);
  }else{
    wrongCount++;
    devilCount++;
    elQWrong.textContent = String(wrongCount);
    elDevilCount.textContent = String(devilCount);
    streakConsec = 0;

    const fr = q.frac;
    const tex = '≈†patnƒõ. Spr√°vn√Ω v√Ωsledek je \\( ' +
      fmtDec(correct) + (fr && fr.d !== 1 ? ' = ' + texFracSimple(fr) : '') + ' \\).';
    setStatus(tex, "bad", true);
  }

  elBtnCheck.disabled = true;

  if(index >= questions.length-1){
    elBtnNext.disabled = true;
    elBtnNextRound.disabled = false;
    roundFinished = true;
  }else{
    elBtnNext.disabled = false;
  }
}

/* ---------- dal≈°√≠ / kola / reset ---------- */
function nextQuestion(){
  if(index < questions.length-1){
    index++;
    showQuestion();
  }
  if(index >= questions.length-1){
    elBtnNext.disabled = true;
  }
}

function startNextRound(){
  if(!roundFinished) return;
  roundNo++;
  elRoundNo.textContent = String(roundNo);
  questions = generateQuestions();
  index = 0;
  elBtnNextRound.disabled = true;
  showQuestion();
}

function resetAll(){
  roundNo = 1;
  questions = generateQuestions();
  index = 0;
  correctCount = 0;
  wrongCount  = 0;
  grannyCount = 0;
  devilCount  = 0;
  streakConsec = 0;
  elRoundNo.textContent = "1";
  elQCorrect.textContent = "0";
  elQWrong.textContent   = "0";
  elGrannyCount.textContent = "0";
  elDevilCount.textContent  = "0";
  elBtnNextRound.disabled = true;
  showQuestion();
}

/* ---------- kl√°vesnice ---------- */
function setActive(input){ activeInput = input; }
elWhole.addEventListener('focus', ()=>setActive(elWhole));
elNum.addEventListener('focus', ()=>setActive(elNum));
elDen.addEventListener('focus', ()=>setActive(elDen));

function handleKey(key){
  if(key === "frac"){
    if(!fractionMode){
      fractionMode = true;
      elWhole.style.display = "none";
      elFracWrap.style.display = "inline-flex";
      if(elWhole.value.trim()){
        elNum.value = elWhole.value;
      }
      activeInput = elNum.value.trim() ? elDen : elNum;
    }else{
      activeInput = (activeInput === elNum ? elDen : elNum);
    }
    activeInput.focus();
    return;
  }

  if(key === "noexist"){
    fractionMode = false;
    elWhole.style.display = "inline-block";
    elFracWrap.style.display = "none";
    elWhole.value = "NEEXISTUJE";
    activeInput = elWhole;
    return;
  }

  if(key === "clear"){
    activeInput.value = "";
    activeInput.focus();
    return;
  }
  if(key === "back"){
    activeInput.value = activeInput.value.slice(0,-1);
    activeInput.focus();
    return;
  }

  let v = activeInput.value;
  if(key === "neg"){
    if(v.startsWith("-")) return;
    activeInput.value = v ? "-" + v : "-";
    activeInput.focus();
    return;
  }
  if(key === ","){
    if(v.includes(",") || v.includes(".")) return;
    if(!v) v = "0";
    activeInput.value = v + ",";
    activeInput.focus();
    return;
  }
  if(/[0-9]/.test(key)){
    activeInput.value += key;
    activeInput.focus();
    return;
  }
}

elKbd.addEventListener('click', e=>{
  const btn = e.target.closest('button[data-key]');
  if(!btn) return;
  const key = btn.getAttribute('data-key');
  handleKey(key);
});

/* Enter = ovƒõ≈ôit */
document.addEventListener('keydown', e=>{
  if(e.key === "Enter"){
    e.preventDefault();
    if(!elBtnCheck.disabled) checkAnswer();
  }
});

/* ---------- tlaƒç√≠tka ---------- */
elBtnCheck.addEventListener('click', checkAnswer);
elBtnNext.addEventListener('click', nextQuestion);
elBtnNextRound.addEventListener('click', startNextRound);
elBtnResetAll.addEventListener('click', resetAll);

/* start */
showQuestion();
</script>
</body>
</html>
